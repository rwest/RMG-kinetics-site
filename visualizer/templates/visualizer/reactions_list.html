{% extends "rmg_base.html" %}

{% block title %}{{ mechanism.name }} Reactions{% endblock %}
{% block page_heading %}{{ mechanism.name }} Reactions{% endblock %}

{% block extrahead %}
<link rel="stylesheet" href="/visualizer/media/visualizer.css" type="text/css">
<link rel="stylesheet" href="/visualizer/media/reactions_list.css" type="text/css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://web.mit.edu/rwest/www/jquery-qtip-1.0.0-rc3112605/jquery.qtip-1.0.0-rc3.min.js">/*This version of qtip only works with jquery 1.4.1, not 1.4.2*/</script>
    <script type="text/javascript">
    // JQuery documentation is at http://docs.jquery.com/
 $(document).ready(function(){
   //  repeat for all selectors
   $("#selectors").find("span").each( function(i) {
       var family = this.id;
     // doesn't help:  family = family.replace(/[#;&,.+*~':"!^$[\]()=>|\/]/g, "\\\\$&"); // escape the funny characters with \\
       $("#"+family).toggle(function(){
         $("."+family).fadeOut('slow');
         $("#"+family).addClass("family_selector_hidden");
       },function(){
         $("."+family).fadeIn('fast');
         $("#"+family).removeClass("family_selector_hidden");
       });
       $("#"+family).addClass("family_selector");
   } );
   
   {% for s in m.species_set %}
   $('img[title={{s.name}}]').qtip({ position: { corner: { target: 'bottomMiddle', tooltip: 'topMiddle' }},
      content: {title: '{{s.name}} (formula)', text:'{{s.smiles}}', url: 'http://cactus.nci.nih.gov/chemical/structure/{{s.smiles}}/names'}
   }){% endfor %}
   
 });
 
</script>
{% endblock %}

{% block navbar_items %}<li><a href="{% url visualizer.views.mechanisms_list %}">Visualizer</a> &raquo;</li>
<li><a href="{% url visualizer.views.mechanism mechanism_id=mechanism.id %}">{{ mechanism.name }}</a> &raquo;</li>{% endblock %}

{% block page_body %}

    <h1>{{ title }}</h1>
    <h2>{{ reactions_list|length }} reactions</h2>

    <div id='selectors'>
        {% for family in families_list %}
        <span id='{{ family|slugify }}'>{{ family }}</span>
        {% endfor %}
        <span id='reactionComment'>Comments</span>
        <span id='species_formula'>Species Formulae</span>
    </div>
    <table class="reactionList">
    {% for reaction in reactions_list %}
     <tr class="reactionRow {{ reaction.family|slugify }}">
     <td class="reactionNumber"> {{ reaction.number }} </td>
      <td class="reactionSide">
       {% for reactant in reaction.reactants_set.all %}
        {% if reactant.stoichiometry != 1 %}{{ reactant.stoichiometry|floatformat }}{% endif %}
        {% if reactant.species.identified %}
        <img src="/media/visualizer/{{ mechanism.id }}/pics/{{ reactant.species.name }}.png" class="speciesPic" alt="{{ reactant.species.name }}" title="{{ reactant.species.name }}">
        {% else %}
        <a href="{% url visualizer.views.species mechanism_id=mechanism.id species_number=reactant.species.number %}"><span class="unidentified">{{ reactant.species.name }}</span></a>
        {% endif %}
        <span class="species_formula">{{ reactant.species.name }}</span>
        {% if not forloop.last %} + {% endif %}
       {% endfor %}
      </td>
      <td>=</td>
      <td class="reactionSide">
       {% for product in reaction.reactants_set.all %}
        {% if product.stoichiometry != 1 %}{{ product.stoichiometry|floatformat }}{% endif %}
        {% if product.species.identified %}
        <img src="/media/visualizer/{{ mechanism.id }}/pics/{{ product.species.name }}.png" class="speciesPic" alt="{{ product.species.name }}" title="{{ product.species.name }}">
        {% else %}
        <a href="{% url visualizer.views.species mechanism_id=mechanism.id species_number=product.species.number %}"><span class="unidentified">{{ product.species.name }}</span></a>
        {% endif %}
        <span class="species_formula">{{ product.species.name }}</span>
        {% if not forloop.last %} + {% endif %}
       {% endfor %}
      </td>
      <td>
        {# rate coefficient #}
      </td>
     </tr>
     <tr class="{{ reaction.family|slugify }}">
      <td></td>
      <td colspan="4" class="reactionComment">
      {{ reaction.comment }}
      </td>
     </tr>
    {% endfor %}
    </table>


{% endblock %}
